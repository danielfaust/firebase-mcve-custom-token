
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-auth.js"></script>

<style>
  pre {
    white-space: pre-wrap; 
  }
</style>

<script>
  
  
  window.addEventListener("load", function() {
    
    //==========================================================================
    
    var log_div = document.getElementById('log_div');
    var log_counter = 0;
    var do_log = function (message) {
      console.log(message);
      log_counter++;
      log_div.innerHTML += '<hr><pre>' + log_counter + ': ' + message + '</pre>';
    }
    
    //==========================================================================
    
    firebase.initializeApp({
      apiKey: "{@@ firebase_api_key @@}",
      authDomain: "{@@ firebase_auth_domain @@}",
    });
    
    //==========================================================================
    
    var loading = true;
    firebase.auth().onAuthStateChanged(function(user) {
      if (loading) {
        loading = false;
        if (user) {
          do_log("loading -- firebase.auth().onAuthStateChanged()", "LOGGED IN AS " + user.email)
        }
        else {
          do_log("loading -- firebase.auth().onAuthStateChanged()", "NOT LOGGED IN, WILL LOG IN NOW")
          
          var firebase_custom_jwt = "{@@ jwt @@}";
          
          do_log("Signing in with this custom jwt token: " + firebase_custom_jwt)
          
          firebase.auth().signInWithCustomToken(firebase_custom_jwt).catch(function(error) {
            var errorCode = error.code;
            var errorMessage = error.message;
            var email = error.email;
            var credential = error.credential;
            do_log("errorCode: " + errorCode)
            do_log("errorMessage: " + errorMessage)
          });
        }
      }
      else {
        if (user) {
          do_log("firebase.auth().onAuthStateChanged(): " + "LOGGED IN AS " + user.email)
        }
        else {
          do_log("firebase.auth().onAuthStateChanged(): " + "NOT LOGGED IN")
        }
      }
    });
    
    //==========================================================================
    
  });
</script>

PAYLOAD:
<br>
<br>
<pre>
{@@ payload @@}
</pre>
<hr>
<br>
<br>
<br>
RESULTING JWT:
<br>
<br>
<pre>
{@@ jwt @@}
</pre>
<hr>
<br>
<br>
<br>
CONSOLE MESSAGES:
<br>
<br>
<div id='log_div'></div>
